{% extends "base.html" %}

{% block title %}ADMIN | EDIT PRODUCT{% endblock %}

{% block content %}
<section class="admin-form-wrap">
    <h1 class="admin-title">상품 수정 (ID: {{ product.id }})</h1>

    <form method="post" enctype="multipart/form-data" class="admin-form">
        <label class="admin-label">
            상품명
            <input type="text" name="name" required class="admin-input" value="{{ product.name }}">
        </label>

        <label class="admin-label">
            가격 (숫자, KRW)
            <input type="number" name="price" min="0" step="1000" class="admin-input" value="{{ product.price }}">
        </label>

        <label class="admin-label">
            대표 이미지(첫 번째 이미지)
            <div class="admin-thumb" style="margin-top: 4px;">
                <img src="{{ url_for('product_image', product_id=product.id) }}" alt="{{ product.name }}">
            </div>
        </label>

        <label class="admin-label">
            등록된 이미지 목록
        </label>

        {% if images %}
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin-bottom:12px;">
            {% for img in images %}
            <div style="width:120px;">
                <div style="border:1px solid #ddd; border-radius:8px; overflow:hidden;">
                    <img src="{{ url_for('product_image_by_id', image_id=img.id) }}" alt="image"
                        style="width:100%; height:140px; object-fit:cover; display:block;">
                </div>

                <form method="post"
                    action="{{ url_for('admin_product_image_delete', product_id=product.id, image_id=img.id) }}"
                    style="margin-top:6px;">
                    <button type="submit" class="admin-secondary-button" style="width:100%; padding:8px 10px;">
                        이미지 삭제
                    </button>
                </form>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="helper-text" style="margin-bottom: 12px;">등록된 이미지가 없습니다.</p>
        {% endif %}

        <label class="auth-label">
            상품 이미지 추가 업로드 (여러 장 가능)
            <input type="file" name="images" multiple accept="image/*" class="auth-input">
        </label>

        <!-- 사이즈 / 재고 -->
        <label class="admin-label" style="margin-top:16px;">
            사이즈 / 재고
        </label>

        <div id="variantRows">
            {% for v in variants %}
            <div class="variant-row" style="display:flex; gap:8px; margin-bottom:6px;">
                <input name="size_name[]" class="admin-input" style="width:80px;" value="{{ v.size }}"
                    placeholder="사이즈">
                <input name="size_stock[]" type="number" min="0" class="admin-input" style="width:120px;"
                    value="{{ v.stock }}" placeholder="재고">
                <button type="button" class="admin-secondary-button" onclick="removeVariantRow(this)">삭제</button>
            </div>
            {% endfor %}
        </div>

        <button type="button" class="admin-secondary-button" onclick="addVariantRow()" style="margin-top:8px;">
            + 사이즈 추가
        </button>

        <script>
            function addVariantRow() {
                const box = document.getElementById("variantRows");
                const row = document.createElement("div");
                row.className = "variant-row";
                row.style.display = "flex";
                row.style.gap = "8px";
                row.style.marginBottom = "6px";
                row.innerHTML = `
                    <input name="size_name[]" class="admin-input" style="width:80px;" placeholder="사이즈">
                    <input name="size_stock[]" type="number" min="0" class="admin-input" style="width:120px;" value="0" placeholder="재고">
                    <button type="button" class="admin-secondary-button" onclick="removeVariantRow(this)">삭제</button>
                `;
                box.appendChild(row);
            }

            function removeVariantRow(btn) {
                btn.parentElement.remove();
            }
        </script>

        <label class="admin-label" style="margin-top:16px;">
            카테고리
            <select name="category" class="admin-input">
                {% for c in categories %}
                <option value="{{ c }}" {% if c==product.category %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
            </select>
        </label>

        <label class="admin-label">
            설명
            <textarea name="description" rows="5" class="admin-input">{{ product.description or "" }}</textarea>
        </label>

        <div class="admin-form-actions">
            <a href="{{ url_for('admin_products') }}" class="admin-secondary-button">취소</a>
            <button type="submit" class="admin-button">저장</button>
        </div>
    </form>
</section>
{% endblock %}